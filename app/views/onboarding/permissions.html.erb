<div class="min-h-screen bg-gray-50 flex items-center justify-center p-4">
  <div class="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden" style="height: 667px;">
    <div class="h-full flex flex-col justify-between p-8">
      <!-- Content -->
      <div class="flex-1">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">Enable permissions</h2>
        <p class="text-gray-600 mb-12">We need a few permissions to provide the best experience</p>

        <!-- Permissions List -->
        <div class="space-y-6">
          <!-- Location Permission -->
          <div class="bg-gray-50 rounded-2xl p-6">
            <div class="flex items-start mb-4">
              <div class="bg-blue-100 rounded-full p-3 mr-4">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-gray-900 mb-1">Location Access</h3>
                <p class="text-sm text-gray-600">Required to show nearby drivers and calculate routes</p>
              </div>
            </div>
            <button type="button" onclick="requestLocationPermission()"
                    class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl hover:bg-blue-700 transition duration-200"
                    id="location-btn">
              Enable Location
            </button>
          </div>

          <!-- Notifications Permission -->
          <div class="bg-gray-50 rounded-2xl p-6">
            <div class="flex items-start mb-4">
              <div class="bg-blue-100 rounded-full p-3 mr-4">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
              </div>
              <div class="flex-1">
                <h3 class="font-semibold text-gray-900 mb-1">Notifications</h3>
                <p class="text-sm text-gray-600">Get updates about your rides and driver arrivals</p>
              </div>
            </div>
            <button type="button" onclick="requestNotificationPermission()"
                    class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl hover:bg-blue-700 transition duration-200"
                    id="notification-btn">
              Enable Notifications
            </button>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="space-y-3">
        <%= form_with url: onboarding_save_permissions_path, method: :post do |f| %>
          <%= f.hidden_field :location_granted, id: "location-granted", value: "false" %>
          <%= f.hidden_field :notifications_granted, id: "notifications-granted", value: "false" %>
          <%= f.submit "Get Started",
              class: "w-full bg-gray-300 text-white font-semibold py-4 rounded-2xl hover:bg-gray-400 transition duration-200 cursor-pointer",
              id: "get-started-btn" %>
        <% end %>
        <%= link_to "Skip for now", onboarding_complete_path,
            class: "block w-full text-center text-gray-600 font-medium py-3 hover:text-gray-900 transition" %>
      </div>
    </div>
  </div>
</div>

<script>
  let locationGranted = false;
  let notificationsGranted = false;

  function requestLocationPermission() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {
          locationGranted = true;
          document.getElementById('location-granted').value = 'true';
          document.getElementById('location-btn').textContent = 'Location Enabled ✓';
          document.getElementById('location-btn').classList.remove('bg-blue-600', 'hover:bg-blue-700');
          document.getElementById('location-btn').classList.add('bg-green-600');
          updateGetStartedButton();
        },
        function(error) {
          alert('Location permission denied. You can enable it later in settings.');
        }
      );
    } else {
      alert('Geolocation is not supported by this browser.');
    }
  }

  function requestNotificationPermission() {
    if ('Notification' in window) {
      Notification.requestPermission().then(function(permission) {
        if (permission === 'granted') {
          notificationsGranted = true;
          document.getElementById('notifications-granted').value = 'true';
          document.getElementById('notification-btn').textContent = 'Notifications Enabled ✓';
          document.getElementById('notification-btn').classList.remove('bg-blue-600', 'hover:bg-blue-700');
          document.getElementById('notification-btn').classList.add('bg-green-600');
          updateGetStartedButton();
        } else {
          alert('Notification permission denied. You can enable it later in settings.');
        }
      });
    } else {
      alert('Notifications are not supported by this browser.');
    }
  }

  function updateGetStartedButton() {
    if (locationGranted && notificationsGranted) {
      const btn = document.getElementById('get-started-btn');
      btn.classList.remove('bg-gray-300', 'hover:bg-gray-400');
      btn.classList.add('bg-blue-600', 'hover:bg-blue-700');
    }
  }
</script>
