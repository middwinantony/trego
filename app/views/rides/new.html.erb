<%# Screen 3: Ride Options - Select ride type with pricing %>
<div class="min-h-screen bg-gray-50">
  <!-- Header -->
  <div class="bg-white shadow-sm sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <div class="flex items-center justify-between">
        <%= link_to rides_path, class: "text-gray-600 hover:text-gray-900" do %>
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        <% end %>
        <h1 class="text-xl font-semibold text-gray-900">Choose a ride</h1>
        <div class="w-6"></div>
      </div>
    </div>
  </div>

  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Route Summary -->
    <div class="bg-white rounded-xl shadow-md p-4 mb-6">
      <div class="flex items-start space-x-3">
        <div class="flex-shrink-0 flex flex-col items-center">
          <div class="h-3 w-3 rounded-full bg-green-500"></div>
          <div class="h-12 w-0.5 bg-gray-300 my-1"></div>
          <div class="h-3 w-3 rounded-full bg-red-500"></div>
        </div>
        <div class="flex-1 min-w-0 space-y-2">
          <div>
            <p class="text-xs text-gray-500">Pickup</p>
            <p class="text-sm font-medium text-gray-900"><%= @ride.pickup %></p>
          </div>
          <div>
            <p class="text-xs text-gray-500">Dropoff</p>
            <p class="text-sm font-medium text-gray-900"><%= @ride.dropoff %></p>
          </div>
        </div>
        <%= link_to "Edit", rides_path, class: "text-indigo-600 hover:text-indigo-800 text-sm font-medium" %>
      </div>

      <% if @ride.distance %>
        <div class="mt-4 flex items-center justify-between text-xs text-gray-500">
          <span><%= number_with_precision(@ride.distance, precision: 1) %> km</span>
          <span>~<%= (@ride.distance / 0.67).round %> min</span>
        </div>
      <% end %>
    </div>

    <!-- Ride Type Options -->
    <%= form_with model: @ride, data: { controller: "ride-options" } do |f| %>
      <%= f.hidden_field :pickup %>
      <%= f.hidden_field :dropoff %>
      <%= f.hidden_field :ride_type, data: { "ride-options-target": "hiddenInput" } %>

      <div class="space-y-4 mb-6">
        <% if @ride_options %>
          <% @ride_options.each do |type, option| %>
            <div data-ride-options-target="card"
                 data-ride-type="<%= type %>"
                 data-action="click->ride-options#select"
                 class="bg-white rounded-xl shadow-md p-4 cursor-pointer transition border-2 border-gray-300 hover:border-indigo-300">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                  <!-- Vehicle Icon -->
                  <div class="flex-shrink-0 h-16 w-16 bg-gray-100 rounded-xl flex items-center justify-center">
                    <svg class="h-10 w-10 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"></path>
                    </svg>
                  </div>

                  <!-- Ride Details -->
                  <div>
                    <h3 class="text-lg font-semibold text-gray-900"><%= option[:name] %></h3>
                    <p class="text-xs text-gray-500"><%= option[:description] %></p>
                    <% if option[:available] %>
                      <div class="flex items-center mt-1 space-x-2">
                        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        <span class="text-xs text-gray-500"><%= option[:capacity] %> seats</span>
                        <span class="text-xs text-gray-400">â€¢</span>
                        <span class="text-xs text-gray-500"><%= option[:eta] %> min away</span>
                      </div>
                    <% else %>
                      <span class="inline-block mt-1 px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded">
                        Unavailable
                      </span>
                    <% end %>
                  </div>
                </div>

                <!-- Price -->
                <div class="text-right">
                  <% if option[:available] %>
                    <p class="text-2xl font-bold text-gray-900">$<%= number_with_precision(option[:price], precision: 2) %></p>
                    <p class="text-xs text-gray-500">Estimated</p>
                  <% else %>
                    <p class="text-sm text-gray-400">N/A</p>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        <% else %>
          <!-- Fallback if no options calculated -->
          <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
            <p class="text-sm text-yellow-700">
              Please enter valid pickup and dropoff locations to see available ride options.
            </p>
          </div>
        <% end %>
      </div>

      <!-- Confirm Button -->
      <%= f.submit "Confirm Ride",
                   data: { "ride-options-target": "submitButton" },
                   disabled: true,
                   class: "w-full bg-indigo-600 text-white font-semibold py-4 px-6 rounded-xl shadow-lg transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed" %>
    <% end %>

    <!-- Payment Info -->
    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-xl p-4">
      <div class="flex items-start space-x-3">
        <svg class="h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div class="flex-1">
          <p class="text-sm font-medium text-blue-900">Payment at completion</p>
          <p class="text-xs text-blue-700 mt-1">You'll be charged after the ride is completed. Card required.</p>
        </div>
      </div>
    </div>
  </div>
</div>
